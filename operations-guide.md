# Керівництво з основних можливостей

Цей документ допоможе Вам швидко зорієнтуватися у ключових розділах системи та зрозуміти, як виконувати типові операції. Всі описи стосуються поточної кодової бази BlazorWasmDotNet8AspNetCoreHosted.

## 1. Структура та навігація

| Розділ меню | Маршрут | Призначення |
|-------------|---------|-------------|
| `Home` | `/` | Стартова сторінка клієнта, технічний landing без спеціальної логіки. |
| `Розклад` | `/schedule` | Перегляд робочого розкладу для студентів і викладачів. |
| `Розклад (адмін)` | `/admin/schedule` | Редагування розкладу адміністраторами; взаємодіє з `ScheduleController`. |
| `Курси` | `/admin/courses` | Управління навчальними курсами (довідник). |
| `Пари` | `/admin/lunch` | Налаштування обідніх вікон/таймінгів. |
| `Календар` | `/admin/calendar` | Робота з навчальним календарем (робочі/вихідні). |
| `Групи` | `/admin/groups` | Управління академічними групами. |
| `Модулі` | `/admin/modules` | Створення та редагування навчальних модулів. |
| `Черговість` | `/admin/module-sequence` | Визначення головних модулів та «заповнювачів» для курсів. |
| `Викладачі` | `/admin/teachers` | Облік викладачів і навантаження. |
| `Аудиторії` | `/admin/rooms` | Довідник аудиторій, пов’язаний із будівлями. |
| `Корпуси` | `/admin/buildings` | Довідник будівель. |
| `Типи занять` | `/admin/lesson-types` | Класифікатор видів занять з ознакою потреби в аудиторії. |
| `Тайм-слоти` | `/admin/time-slots` | Шаблони початку/завершення занять. |
| `Чернетки викладачів` | `/teacher-drafts` | Попереднє планування занять силами викладачів; інтеграція з `TeacherDraftsController`. |

> **Примітка:** фактична реалізація сторінок знаходиться в каталозі `BlazorWasmDotNet8AspNetCoreHosted.Client/Pages`, а відповідні контролери — в просторі `BlazorWasmDotNet8AspNetCoreHosted.Server/Controllers`.

## 2. Ключові сценарії

### 2.1 Адміністрування модулів

- Компонент `AdminModules.razor` звертається до `AdminModulesController` (`/api/admin/modules`).  
- Ви можете створювати модуль, вказуючи код, назву, курс та характеристику (кредити, компетентності, результати навчання, форму звітності).  
- Доступні масові дії: вибір будівель та аудиторій, у яких дозволено проводити заняття, а також автоматичне дублювання модуля на пов’язані курси.  
- Видалення модуля перевіряє використання в розкладі. Якщо таблиця `ScheduleItems` містить записи, система вимагатиме підтвердити `force=true`, а також перераховує навантаження викладачів (`TeacherCourseLoads`).

### 2.2 Побудова послідовності модулів

- Сторінка `/admin/module-sequence` дозволяє формувати перелік «головних» модулів (черга) та позначати додаткові модулі як заповнювачі.  
- Збереження викликає API `AdminModuleSequenceController` (розташований у `Server/Controllers/Admin`).  
- Ви можете:
  1. Вибрати курс та завантажити поточну послідовність.
  2. Перетягувати модулі в основний список або назад у перелік доступних.
  3. Позначати модулі як «заповнювачі» (checkbox у таблиці).  
- Після натискання «Зберегти» дані зберігаються в таблицях, що моделюють послідовність (`ModuleSequences` та супутні сутності).

### 2.3 Розклад і правила перевірки

- `ScheduleController` (`Server/Controllers/ScheduleController.cs`) відповідає за CRUD-операції розкладу: отримання розкладу за тиждень, створення/оновлення (`/api/schedule/upsert`) та видалення (через окремі методи).  
- Основні особливості:
  - Валідація виконується сервісом `RulesService` (`Server/Application/RulesService.cs`). Він перевіряє перетини за групами, викладачами, аудиторіями, робочі дні тощо.  
  - Під час додавання/оновлення використовується транзакція `Serializable`, аби уникнути конфліктів.
  - Після збереження перераховуються плани (таблиця `ModulePlans`) і навантаження (`TeacherCourseLoads`), якщо змінюються модуль чи викладач.
  - У разі заняття з типом `RESCHEDULED` можлива автоматична генерація копії попереднього запису.
  - Дані повертаються у DTO `ScheduleItemDto` (`Shared/DTOs`).  
- Клієнтська частина (`Pages/Schedule.razor` та `/admin/schedule`) використовує ці API для візуалізації календаря та внесення змін.

### 2.4 Чернетки викладачів

- `TeacherDrafts.razor` забезпечує drag-and-drop інтерфейс. Ви можете:
  - Перемикати тижні (кнопки «Попередній тиждень» / «Наступний тиждень»).
  - Фільтрувати чернетки за викладачем, групою чи аудиторією.
  - Редагувати окремі записи з деталями модуля, теми, типу заняття та аудиторії.
  - Переглядати попередження (`_warningReports`) щодо конфліктів і перетинів.  
- API:  
  - `TeacherDraftsController` (`Server/Controllers/TeacherDraftsController.cs`) — видає дані на тиждень, приймає оновлення, дозволяє публікацію.  
  - Публікація тижня (`PublishWeek`) переносить затверджені чернетки до `ScheduleItems` з повторним викликом `RulesService`.
  - Сторінка зберігає стан конфліктів у `localStorage` (`teacherDrafts.conflicts.v1`), щоб Ви могли повертатися до виявлених проблем.

### 2.5 Довідники та метадані

- `api/meta` (реалізується у відповідних контролерах) надає агрегований набір довідників для інтерфейсу: курси, групи, викладачі, типи занять, аудиторії, будівлі.  
- Сервіс `RulesService` спирається на довідники та таблиці-конфігурації (`AdminModulesController` надає дозволені аудиторії, `AdminCalendarController` — робочі дні, `AdminLunchController` — тайм-слоти перерв тощо).

## 3. Рекомендований робочий процес

1. **Підготуйте довідники**: створіть курси, будівлі, аудиторії, викладачів і групи. Для кожного типу контенту використовуйте відповідну сторінку `/admin/...`.  
2. **Створіть модулі та визначте дозволені локації** на `/admin/modules`. За потреби дублюйте модуль у споріднені курси.  
3. **Задайте черговість модулів** для кожного курсу на `/admin/module-sequence`, відзначивши основні та додаткові дисципліни.  
4. **Запросіть викладачів внести чернетки** на сторінці `/teacher-drafts`. Вони зможуть підібрати теми уроків, узгодити тайм-слоти й перевірити попередження.  
5. **Опублікуйте тижневі плани** (функція `PublishWeek`), щоби перенести узгоджені чернетки в робочий розклад.  
6. **Керуйте розкладом адміністративно** через `/admin/schedule`, якщо потрібні оперативні коригування, з урахуванням перевірок `RulesService`.  
7. **Моніторинг навантаження**: переглядайте та коригуйте `TeacherCourseLoads` у відповідних розділах (викладачі/курси), щоб гарантувати баланс.  

## 4. Технічні довідки

- **EF Core**: форма міграцій описана в `README.md`. Базова міграція — `20251027190602_InitialCreate`.  
- **Правила валідації**: реалізація знаходиться у `Server/Application/RulesService.cs`. Саме тут Ви зможете додавати нові обмеження або розслабляти чинні.  
- **DTO та мапінг**: усі типи для обміну даними між клієнтом і сервером зібрані в `Shared/DTOs`. Фабрики перетворення (наприклад, `ScheduleItemExtensions.ToDto`) розташовані поряд із сутностями у `Server/Domain`.  
- **Метадані для UI**: методи `MetaController` (перевірте `Server/Controllers/Admin` та суміжні класі) повертають узагальнений набір довідників, який кешується на клієнті.  
- **Front-end сервіс**: клієнтська логіка звернень до адміністративного API зосереджена у `Client/Services/AdminApi.cs`, а до чернеток — у `Client/Services/TeacherDraftsApi.cs`.

## 5. Корисні поради

- Якщо виникає потреба швидко очистити й пересоздати схему, безпечно дропайте базу та виконуйте `dotnet ef database update` — початкова міграція містить повну структуру.  